<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmailMax Pro - Plateforme Email Marketing</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìß</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4A4ACC'
                    }
                }
            }
        }
    </script>
    <style>
        .animate-pulse-slow { 
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; 
        }
        .gradient-bg { 
            background: linear-gradient(135deg, #5D5CDE 0%, #4A4ACC 100%); 
        }
        .glass { 
            backdrop-filter: blur(10px); 
            background: rgba(255, 255, 255, 0.1); 
        }
        .card-hover:hover { 
            transform: translateY(-2px); 
            transition: all 0.3s ease; 
        }
        
        /* Animations fluides */
        .section {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Mode sombre am√©lior√© */
        .dark .bg-white { background-color: #1f2937; }
        .dark .text-gray-900 { color: #f9fafb; }
        .dark .border-gray-200 { border-color: #374151; }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .dark ::-webkit-scrollbar-track {
            background: #374151;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #6b7280;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">

<div id="app" class="min-h-screen">
    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 gradient-bg rounded-xl flex items-center justify-center shadow-lg">
                            <i data-lucide="mail" class="w-6 h-6 text-white"></i>
                        </div>
                        <div>
                            <h1 class="font-bold text-xl text-gray-900 dark:text-white">EmailMax Pro</h1>
                            <p class="text-xs text-gray-500 dark:text-gray-400">Marketing Platform</p>
                        </div>
                    </div>
                </div>
                
                <!-- User Info & Actions -->
                <div class="flex items-center space-x-4">
                    <div class="hidden sm:block text-right">
                        <p class="text-sm font-medium text-gray-900 dark:text-white">Admin</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">admin@emailmax.fr</p>
                    </div>
                    <button onclick="toggleDarkMode()" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                        <i data-lucide="moon" class="w-5 h-5 text-gray-600 dark:text-gray-300"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Layout principal -->
    <div class="flex">
        <!-- Sidebar -->
        <aside class="w-64 bg-white dark:bg-gray-800 shadow-lg min-h-screen sticky top-16 border-r border-gray-200 dark:border-gray-700">
            <nav class="p-4">
                <ul class="space-y-2">
                    <li>
                        <a href="#" onclick="showSection('dashboard')" class="nav-item flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 group">
                            <i data-lucide="bar-chart-3" class="w-5 h-5 mr-3 group-hover:scale-110 transition-transform"></i>
                            <span class="font-medium">Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showSection('contacts')" class="nav-item flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 group">
                            <i data-lucide="users" class="w-5 h-5 mr-3 group-hover:scale-110 transition-transform"></i>
                            <span class="font-medium">Contacts</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showSection('campaigns')" class="nav-item flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 group">
                            <i data-lucide="send" class="w-5 h-5 mr-3 group-hover:scale-110 transition-transform"></i>
                            <span class="font-medium">Campagnes</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showSection('templates')" class="nav-item flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 group">
                            <i data-lucide="layout-template" class="w-5 h-5 mr-3 group-hover:scale-110 transition-transform"></i>
                            <span class="font-medium">Templates</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showSection('analytics')" class="nav-item flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 group">
                            <i data-lucide="trending-up" class="w-5 h-5 mr-3 group-hover:scale-110 transition-transform"></i>
                            <span class="font-medium">Analytics</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Contenu principal -->
        <main class="flex-1 p-6 lg:p-8 bg-gray-50 dark:bg-gray-900 min-h-screen">
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="section">
                <div class="mb-8">
                    <h1 class="text-3xl lg:text-4xl font-bold text-gray-900 dark:text-white mb-2">Dashboard</h1>
                    <p class="text-gray-600 dark:text-gray-400 text-lg">Vue d'ensemble de vos campagnes email</p>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg card-hover border border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Total Contacts</p>
                                <p class="text-3xl font-bold text-gray-900 dark:text-white" id="total-contacts">0</p>
                                <p class="text-xs text-green-600 dark:text-green-400 mt-1">+12% ce mois</p>
                            </div>
                            <div class="p-3 bg-blue-100 dark:bg-blue-900/30 rounded-xl">
                                <i data-lucide="users" class="w-8 h-8 text-blue-600 dark:text-blue-400"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg card-hover border border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Emails Envoy√©s</p>
                                <p class="text-3xl font-bold text-gray-900 dark:text-white" id="emails-sent">0</p>
                                <p class="text-xs text-green-600 dark:text-green-400 mt-1">+25% ce mois</p>
                            </div>
                            <div class="p-3 bg-green-100 dark:bg-green-900/30 rounded-xl">
                                <i data-lucide="send" class="w-8 h-8 text-green-600 dark:text-green-400"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg card-hover border border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Taux d'Ouverture</p>
                                <p class="text-3xl font-bold text-gray-900 dark:text-white" id="open-rate">0%</p>
                                <p class="text-xs text-green-600 dark:text-green-400 mt-1">+5% ce mois</p>
                            </div>
                            <div class="p-3 bg-purple-100 dark:bg-purple-900/30 rounded-xl">
                                <i data-lucide="eye" class="w-8 h-8 text-purple-600 dark:text-purple-400"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg card-hover border border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-1">Taux de Clic</p>
                                <p class="text-3xl font-bold text-gray-900 dark:text-white" id="click-rate">0%</p>
                                <p class="text-xs text-green-600 dark:text-green-400 mt-1">+8% ce mois</p>
                            </div>
                            <div class="p-3 bg-orange-100 dark:bg-orange-900/30 rounded-xl">
                                <i data-lucide="mouse-pointer-click" class="w-8 h-8 text-orange-600 dark:text-orange-400"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <div class="lg:col-span-2">
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700">
                            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                                <h2 class="text-xl font-semibold text-gray-900 dark:text-white">Campagnes R√©centes</h2>
                            </div>
                            <div class="p-6">
                                <div id="recent-campaigns" class="space-y-4">
                                    <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                                        <i data-lucide="mail" class="w-16 h-16 mx-auto mb-4 opacity-50"></i>
                                        <p class="text-lg font-medium mb-2">Aucune campagne encore</p>
                                        <p class="text-sm">Cr√©ez votre premi√®re campagne pour commencer</p>
                                        <button onclick="showSection('campaigns')" class="mt-4 gradient-bg text-white px-6 py-3 rounded-xl hover:opacity-90 transition-opacity">
                                            Cr√©er une campagne
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Actions Rapides</h3>
                            <div class="space-y-3">
                                <button onclick="showSection('contacts')" class="w-full flex items-center p-3 text-left text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl transition-colors">
                                    <i data-lucide="user-plus" class="w-5 h-5 mr-3"></i>
                                    Ajouter des contacts
                                </button>
                                <button onclick="showSection('campaigns')" class="w-full flex items-center p-3 text-left text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl transition-colors">
                                    <i data-lucide="send" class="w-5 h-5 mr-3"></i>
                                    Nouvelle campagne
                                </button>
                                <button onclick="showSection('templates')" class="w-full flex items-center p-3 text-left text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl transition-colors">
                                    <i data-lucide="layout-template" class="w-5 h-5 mr-3"></i>
                                    Parcourir templates
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contacts Section -->
            <div id="contacts-section" class="section hidden">
                <div class="mb-8 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                    <div>
                        <h1 class="text-3xl lg:text-4xl font-bold text-gray-900 dark:text-white mb-2">Gestion des Contacts</h1>
                        <p class="text-gray-600 dark:text-gray-400 text-lg">Importez et g√©rez vos listes de contacts</p>
                    </div>
                    <button onclick="showImportModal()" class="gradient-bg text-white px-6 py-3 rounded-xl hover:opacity-90 transition-opacity flex items-center space-x-2 shadow-lg">
                        <i data-lucide="upload" class="w-5 h-5"></i>
                        <span>Importer Contacts</span>
                    </button>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-1">Contacts Actifs</h3>
                                <p class="text-3xl font-bold text-green-600" id="active-contacts">0</p>
                            </div>
                            <div class="p-3 bg-green-100 dark:bg-green-900/30 rounded-xl">
                                <i data-lucide="user-check" class="w-8 h-8 text-green-600 dark:text-green-400"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-1">D√©sabonn√©s</h3>
                                <p class="text-3xl font-bold text-red-600" id="unsubscribed-contacts">0</p>
                            </div>
                            <div class="p-3 bg-red-100 dark:bg-red-900/30 rounded-xl">
                                <i data-lucide="user-x" class="w-8 h-8 text-red-600 dark:text-red-400"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-1">Bounces</h3>
                                <p class="text-3xl font-bold text-orange-600" id="bounced-contacts">0</p>
                            </div>
                            <div class="p-3 bg-orange-100 dark:bg-orange-900/30 rounded-xl">
                                <i data-lucide="mail-x" class="w-8 h-8 text-orange-600 dark:text-orange-400"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contacts Table -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                            <h2 class="text-xl font-semibold text-gray-900 dark:text-white">Liste des Contacts</h2>
                            <div class="flex flex-col sm:flex-row gap-3 w-full sm:w-auto">
                                <input type="text" id="search-contacts" placeholder="Rechercher..." class="px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                                <select id="filter-status" class="px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="">Tous les statuts</option>
                                    <option value="active">Actifs</option>
                                    <option value="unsubscribed">D√©sabonn√©s</option>
                                    <option value="bounced">Bounces</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="text-left py-4 px-6 font-semibold text-gray-900 dark:text-white">Email</th>
                                    <th class="text-left py-4 px-6 font-semibold text-gray-900 dark:text-white">Nom</th>
                                    <th class="text-left py-4 px-6 font-semibold text-gray-900 dark:text-white">Statut</th>
                                    <th class="text-left py-4 px-6 font-semibold text-gray-900 dark:text-white">Ajout√© le</th>
                                    <th class="text-left py-4 px-6 font-semibold text-gray-900 dark:text-white">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="contacts-tbody">
                                <tr>
                                    <td colspan="5" class="text-center py-12 text-gray-500 dark:text-gray-400">
                                        <i data-lucide="users" class="w-16 h-16 mx-auto mb-4 opacity-50"></i>
                                        <p class="text-lg font-medium mb-2">Aucun contact import√©</p>
                                        <p class="text-sm">Commencez par importer votre premi√®re liste de contacts</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Campaigns Section -->
            <div id="campaigns-section" class="section hidden">
                <div class="mb-8 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                    <div>
                        <h1 class="text-3xl lg:text-4xl font-bold text-gray-900 dark:text-white mb-2">Campagnes Email</h1>
                        <p class="text-gray-600 dark:text-gray-400 text-lg">Cr√©ez et g√©rez vos campagnes d'email marketing</p>
                    </div>
                    <button onclick="showCampaignModal()" class="gradient-bg text-white px-6 py-3 rounded-xl hover:opacity-90 transition-opacity flex items-center space-x-2 shadow-lg">
                        <i data-lucide="plus" class="w-5 h-5"></i>
                        <span>Nouvelle Campagne</span>
                    </button>
                </div>

                <!-- Campaigns Grid -->
                <div id="campaigns-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Le contenu sera g√©n√©r√© dynamiquement -->
                </div>
            </div>

            <!-- Templates Section -->
            <div id="templates-section" class="section hidden">
                <div class="mb-8">
                    <h1 class="text-3xl lg:text-4xl font-bold text-gray-900 dark:text-white mb-2">Templates Email</h1>
                    <p class="text-gray-600 dark:text-gray-400 text-lg">Mod√®les professionnels pour vos campagnes</p>
                </div>

                <!-- Templates Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden card-hover">
                        <div class="p-6 bg-gradient-to-r from-blue-500 to-purple-600 text-white">
                            <h3 class="text-xl font-semibold mb-2">Newsletter Moderne</h3>
                            <p class="text-blue-100">Template √©l√©gant et professionnel</p>
                        </div>
                        <div class="p-6">
                            <p class="text-gray-600 dark:text-gray-400 mb-6">Template √©l√©gant pour newsletters avec sections organis√©es et call-to-action percutants.</p>
                            <button onclick="useTemplate('newsletter')" class="w-full gradient-bg text-white py-3 rounded-xl hover:opacity-90 transition-opacity font-medium">
                                Utiliser ce template
                            </button>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden card-hover">
                        <div class="p-6 bg-gradient-to-r from-green-500 to-teal-600 text-white">
                            <h3 class="text-xl font-semibold mb-2">Promotion</h3>
                            <p class="text-green-100">Offres et r√©ductions sp√©ciales</p>
                        </div>
                        <div class="p-6">
                            <p class="text-gray-600 dark:text-gray-400 mb-6">Template pour promotions et offres sp√©ciales avec design accrocheur et boutons d'action.</p>
                            <button onclick="useTemplate('promotion')" class="w-full gradient-bg text-white py-3 rounded-xl hover:opacity-90 transition-opacity font-medium">
                                Utiliser ce template
                            </button>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden card-hover">
                        <div class="p-6 bg-gradient-to-r from-orange-500 to-red-600 text-white">
                            <h3 class="text-xl font-semibold mb-2">√âv√©nement</h3>
                            <p class="text-orange-100">Invitations et webinaires</p>
                        </div>
                        <div class="p-6">
                            <p class="text-gray-600 dark:text-gray-400 mb-6">Template pour invitations d'√©v√©nements, webinaires et conf√©rences avec agenda d√©taill√©.</p>
                            <button onclick="useTemplate('event')" class="w-full gradient-bg text-white py-3 rounded-xl hover:opacity-90 transition-opacity font-medium">
                                Utiliser ce template
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="analytics-section" class="section hidden">
                <div class="mb-8">
                    <h1 class="text-3xl lg:text-4xl font-bold text-gray-900 dark:text-white mb-2">Analytics</h1>
                    <p class="text-gray-600 dark:text-gray-400 text-lg">Analysez les performances de vos campagnes</p>
                </div>

                <!-- Analytics Overview -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">√âvolution des Envois</h3>
                        <div class="h-64 flex items-center justify-center bg-gray-50 dark:bg-gray-700 rounded-xl">
                            <div class="text-center">
                                <i data-lucide="bar-chart" class="w-16 h-16 mx-auto mb-4 text-gray-400"></i>
                                <p class="text-gray-600 dark:text-gray-400 font-medium">Graphique des envois</p>
                                <p class="text-sm text-gray-500 dark:text-gray-500">Donn√©es disponibles apr√®s vos premi√®res campagnes</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">Taux d'Engagement</h3>
                        <div class="h-64 flex items-center justify-center bg-gray-50 dark:bg-gray-700 rounded-xl">
                            <div class="text-center">
                                <i data-lucide="pie-chart" class="w-16 h-16 mx-auto mb-4 text-gray-400"></i>
                                <p class="text-gray-600 dark:text-gray-400 font-medium">Graphique d'engagement</p>
                                <p class="text-sm text-gray-500 dark:text-gray-500">Donn√©es disponibles apr√®s vos premi√®res campagnes</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Top Performing Campaigns -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                        <h2 class="text-xl font-semibold text-gray-900 dark:text-white">Campagnes les Plus Performantes</h2>
                    </div>
                    <div class="p-6">
                        <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                            <i data-lucide="trending-up" class="w-16 h-16 mx-auto mb-4 opacity-50"></i>
                            <p class="text-lg font-medium mb-2">Aucune donn√©e d'analytics</p>
                            <p class="text-sm">Les donn√©es d'analytics s'afficheront apr√®s vos premi√®res campagnes envoy√©es</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal d'import des contacts -->
    <div id="import-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Importer des Contacts</h2>
                    <button onclick="closeImportModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 p-1">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <!-- M√©thode d'import -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
                        M√©thode d'import
                    </label>
                    <div class="flex space-x-4">
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="import-method" value="csv" checked class="mr-2 text-primary">
                            <span class="text-gray-700 dark:text-gray-300">Fichier CSV</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="import-method" value="manual" class="mr-2 text-primary">
                            <span class="text-gray-700 dark:text-gray-300">Saisie manuelle</span>
                        </label>
                    </div>
                </div>

                <!-- Import CSV -->
                <div id="csv-import" class="import-method">
                    <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-8 text-center hover:border-primary transition-colors">
                        <i data-lucide="upload" class="w-12 h-12 mx-auto mb-4 text-gray-400"></i>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">Glissez votre fichier CSV ici ou cliquez pour s√©lectionner</p>
                        <input type="file" id="csv-file" accept=".csv" class="hidden">
                        <button onclick="document.getElementById('csv-file').click()" class="gradient-bg text-white px-6 py-3 rounded-xl hover:opacity-90 transition-opacity">
                            Choisir un fichier
                        </button>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-4">Format attendu: email,nom,pr√©nom</p>
                    </div>
                </div>

                <!-- Import manuel -->
                <div id="manual-import" class="import-method hidden">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Emails (un par ligne)
                        </label>
                        <textarea id="manual-emails" rows="8" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="exemple1@email.com&#10;exemple2@email.com&#10;exemple3@email.com"></textarea>
                    </div>
                </div>

                <!-- Boutons d'action -->
                <div class="flex justify-end space-x-4 mt-6">
                    <button onclick="closeImportModal()" class="px-6 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors">
                        Annuler
                    </button>
                    <button onclick="importContacts()" class="gradient-bg text-white px-6 py-3 rounded-xl hover:opacity-90 transition-opacity">
                        Importer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de cr√©ation de campagne -->
    <div id="campaign-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Nouvelle Campagne Email</h2>
                    <button onclick="closeCampaignModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 p-1">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <form id="campaign-form" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Nom de la campagne
                            </label>
                            <input type="text" id="campaign-name" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Ex: Newsletter F√©vrier 2024">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Sujet de l'email
                            </label>
                            <input type="text" id="campaign-subject" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Ex: D√©couvrez nos nouveaut√©s">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Contenu de l'email
                        </label>
                        <textarea id="campaign-content" rows="12" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="R√©digez votre message ici..."></textarea>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">
                            Variables disponibles: [PRENOM], [NOM], [EMAIL], [DATE]
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Envoyer √†
                            </label>
                            <select id="campaign-audience" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="all">Tous les contacts actifs</option>
                                <option value="recent">Contacts r√©cents (30 jours)</option>
                                <option value="engaged">Contacts engag√©s</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Programmer l'envoi
                            </label>
                            <select id="campaign-schedule" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                                <option value="now">Envoyer maintenant</option>
                                <option value="schedule">Programmer pour plus tard</option>
                            </select>
                        </div>
                    </div>

                    <div id="schedule-datetime" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Date et heure d'envoi
                        </label>
                        <input type="datetime-local" id="campaign-datetime" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>

                    <div class="flex justify-end space-x-4 pt-4">
                        <button type="button" onclick="closeCampaignModal()" class="px-6 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors">
                            Annuler
                        </button>
                        <button type="button" onclick="createCampaign()" class="gradient-bg text-white px-6 py-3 rounded-xl hover:opacity-90 transition-opacity">
                            <span id="campaign-submit-text">Cr√©er la campagne</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de progression -->
    <div id="progress-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full mx-4">
            <div class="p-8">
                <div class="text-center">
                    <div class="mb-6">
                        <i data-lucide="send" class="w-16 h-16 mx-auto text-primary animate-pulse-slow"></i>
                    </div>
                    <h3 class="text-2xl font-semibold text-gray-900 dark:text-white mb-3">Envoi en cours...</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-6" id="progress-text">Pr√©paration de la campagne</p>
                    
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 mb-4">
                        <div id="progress-bar" class="gradient-bg h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                    
                    <p class="text-sm text-gray-500 dark:text-gray-400">
                        <span id="progress-count">0</span> / <span id="progress-total">0</span> emails envoy√©s
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Configuration s√©curis√©e Brevo API 
let BREVO_API_KEY = null;

// Fonction pour r√©cup√©rer la cl√© API de mani√®re s√©curis√©e
async function getBrevoApiKey() {
    if (BREVO_API_KEY) return BREVO_API_KEY;
    
    try {
        // Tentative de r√©cup√©ration via API backend s√©curis√©e
        const response = await fetch('/api/brevo-key');
        if (response.ok) {
            const data = await response.json();
            BREVO_API_KEY = data.apiKey;
            return BREVO_API_KEY;
        }
    } catch (error) {
        console.warn('API backend non disponible');
    }
    
    // Fallback - demander √† l'utilisateur de configurer la cl√©
    const apiKey = prompt('Veuillez entrer votre cl√© API Brevo:');
    if (apiKey) {
        BREVO_API_KEY = apiKey;
        return BREVO_API_KEY;
    }
    
    throw new Error('Cl√© API Brevo requise');
}

// √âtat global de l'application
let currentSection = 'dashboard';
let contacts = [];
let campaigns = [];
let analytics = {
    totalContacts: 0,
    emailsSent: 0,
    openRate: 0,
    clickRate: 0,
    activeContacts: 0,
    unsubscribedContacts: 0,
    bouncedContacts: 0
};

// Gestion du mode sombre
function toggleDarkMode() {
    document.documentElement.classList.toggle('dark');
    localStorage.setItem('darkMode', document.documentElement.classList.contains('dark'));
    
    // Mettre √† jour l'ic√¥ne
    const icon = document.querySelector('[data-lucide="moon"]');
    if (document.documentElement.classList.contains('dark')) {
        icon.setAttribute('data-lucide', 'sun');
    } else {
        icon.setAttribute('data-lucide', 'moon');
    }
    lucide.createIcons();
}

// Initialisation du mode sombre
if (localStorage.getItem('darkMode') === 'true' || 
    (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches && !localStorage.getItem('darkMode'))) {
    document.documentElement.classList.add('dark');
}

window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
    if (!localStorage.getItem('darkMode')) {
        if (event.matches) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    }
});

// Navigation entre sections
function showSection(section) {
    // Masquer toutes les sections
    document.querySelectorAll('.section').forEach(el => el.classList.add('hidden'));
    document.getElementById(section + '-section').classList.remove('hidden');
    
    // Mettre √† jour la navigation active
    document.querySelectorAll('.nav-item').forEach(el => {
        el.classList.remove('bg-primary', 'text-white');
        el.classList.add('text-gray-700', 'dark:text-gray-300');
    });
    event.target.closest('.nav-item').classList.add('bg-primary', 'text-white');
    event.target.closest('.nav-item').classList.remove('text-gray-700', 'dark:text-gray-300');
    
    currentSection = section;
    
    // Charger les donn√©es sp√©cifiques √† la section
    if (section === 'dashboard') {
        updateDashboard();
    } else if (section === 'contacts') {
        updateContactsTable();
    } else if (section === 'campaigns') {
        updateCampaignsGrid();
    }
}

// Gestion des modals
function showImportModal() {
    document.getElementById('import-modal').classList.remove('hidden');
    document.getElementById('import-modal').classList.add('flex');
    document.body.style.overflow = 'hidden';
}

function closeImportModal() {
    document.getElementById('import-modal').classList.add('hidden');
    document.getElementById('import-modal').classList.remove('flex');
    document.body.style.overflow = '';
}

function showCampaignModal() {
    document.getElementById('campaign-modal').classList.remove('hidden');
    document.getElementById('campaign-modal').classList.add('flex');
    document.body.style.overflow = 'hidden';
}

function closeCampaignModal() {
    document.getElementById('campaign-modal').classList.add('hidden');
    document.getElementById('campaign-modal').classList.remove('flex');
    document.body.style.overflow = '';
    
    // Reset du formulaire
    document.getElementById('campaign-form').reset();
    document.getElementById('schedule-datetime').classList.add('hidden');
}

// Gestion des √©v√©nements
document.addEventListener('change', function(e) {
    if (e.target.name === 'import-method') {
        document.querySelectorAll('.import-method').forEach(el => el.classList.add('hidden'));
        if (e.target.value === 'csv') {
            document.getElementById('csv-import').classList.remove('hidden');
        } else {
            document.getElementById('manual-import').classList.remove('hidden');
        }
    }
    
    if (e.target.id === 'campaign-schedule') {
        const scheduleDiv = document.getElementById('schedule-datetime');
        if (e.target.value === 'schedule') {
            scheduleDiv.classList.remove('hidden');
        } else {
            scheduleDiv.classList.add('hidden');
        }
    }
});

// Gestion des fichiers CSV
document.getElementById('csv-file').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const csv = e.target.result;
            showNotification('Fichier CSV charg√© avec succ√®s!', 'success');
        };
        reader.readAsText(file);
    }
});

// Import des contacts
function importContacts() {
    const method = document.querySelector('input[name="import-method"]:checked').value;
    let newContacts = [];
    
    if (method === 'csv') {
        const csvFile = document.getElementById('csv-file').files[0];
        if (!csvFile) {
            showNotification('Veuillez s√©lectionner un fichier CSV', 'error');
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            const csv = e.target.result;
            const lines = csv.split('\n');
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = lines[i].split(',');
                    const email = values[0]?.trim();
                    const nom = values[1]?.trim() || '';
                    const prenom = values[2]?.trim() || '';
                    
                    if (email && isValidEmail(email)) {
                        newContacts.push({
                            email: email,
                            nom: nom,
                            prenom: prenom,
                            status: 'active',
                            dateAdded: new Date().toLocaleDateString('fr-FR')
                        });
                    }
                }
            }
            
            processImport(newContacts);
        };
        reader.readAsText(csvFile);
    } else {
        // Saisie manuelle
        const emailsText = document.getElementById('manual-emails').value;
        const emailLines = emailsText.split('\n');
        
        emailLines.forEach(line => {
            const email = line.trim();
            if (email && isValidEmail(email)) {
                newContacts.push({
                    email: email,
                    nom: '',
                    prenom: '',
                    status: 'active',
                    dateAdded: new Date().toLocaleDateString('fr-FR')
                });
            }
        });
        
        processImport(newContacts);
    }
}

function processImport(newContacts) {
    // Supprimer les doublons
    const existingEmails = contacts.map(c => c.email);
    const uniqueContacts = newContacts.filter(c => !existingEmails.includes(c.email));
    
    contacts.push(...uniqueContacts);
    updateAnalytics();
    
    closeImportModal();
    showNotification(`${uniqueContacts.length} contacts import√©s avec succ√®s!`, 'success');
    
    // Reset des formulaires
    document.getElementById('csv-file').value = '';
    document.getElementById('manual-emails').value = '';
    
    updateContactsTable();
    updateDashboard();
}

// Cr√©ation de campagne
async function createCampaign() {
    const name = document.getElementById('campaign-name').value;
    const subject = document.getElementById('campaign-subject').value;
    const content = document.getElementById('campaign-content').value;
    const audience = document.getElementById('campaign-audience').value;
    const schedule = document.getElementById('campaign-schedule').value;
    
    if (!name || !subject || !content) {
        showNotification('Veuillez remplir tous les champs obligatoires', 'error');
        return;
    }
    
    const campaign = {
        id: Date.now(),
        name: name,
        subject: subject,
        content: content,
        audience: audience,
        schedule: schedule,
        status: schedule === 'now' ? 'sending' : 'scheduled',
        created: new Date().toLocaleDateString('fr-FR'),
        sent: 0,
        opens: 0,
        clicks: 0
    };
    
    campaigns.push(campaign);
    closeCampaignModal();
    
    if (schedule === 'now') {
        await sendCampaign(campaign);
    } else {
        showNotification('Campagne programm√©e avec succ√®s!', 'success');
    }
    
    updateCampaignsGrid();
    updateDashboard();
}

// Envoi de campagne
async function sendCampaign(campaign) {
    const activeContacts = contacts.filter(c => c.status === 'active');
    
    if (activeContacts.length === 0) {
        showNotification('Aucun contact actif trouv√©', 'error');
        return;
    }
    
    showProgressModal(activeContacts.length);
    
    // R√©cup√©ration de la cl√© API
    const apiKey = await getBrevoApiKey();
    
    if (apiKey === 'demo-mode') {
        // Mode d√©mo - simulation d'envoi
        await simulateCampaignSending(campaign, activeContacts);
    } else {
        // Envoi r√©el avec Brevo
        await sendCampaignWithBrevo(campaign, activeContacts, apiKey);
    }
}

// Simulation d'envoi (mode d√©mo)
async function simulateCampaignSending(campaign, activeContacts) {
    const batchSize = 10;
    let sent = 0;
    
    for (let i = 0; i < activeContacts.length; i += batchSize) {
        const batch = activeContacts.slice(i, i + batchSize);
        
        // Simulation du d√©lai d'envoi
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        sent += batch.length;
        campaign.sent += batch.length;
        
        // Simulation des statistiques
        const opens = Math.floor(batch.length * (0.2 + Math.random() * 0.3));
        const clicks = Math.floor(opens * (0.1 + Math.random() * 0.2));
        
        campaign.opens += opens;
        campaign.clicks += clicks;
        
        updateProgress(sent, activeContacts.length);
    }
    
    finalizeCampaign(campaign);
}

// Envoi r√©el avec Brevo API
async function sendCampaignWithBrevo(campaign, activeContacts, apiKey) {
    const batchSize = 5; // Brevo recommande des petits batches
    let sent = 0;
    let errors = 0;
    
    for (let i = 0; i < activeContacts.length; i += batchSize) {
        const batch = activeContacts.slice(i, i + batchSize);
        
        try {
            await sendEmailBatch(batch, campaign, apiKey);
            sent += batch.length;
            campaign.sent += batch.length;
            
            // Simulation des statistiques d'ouverture/clic
            const opens = Math.floor(batch.length * (0.2 + Math.random() * 0.3));
            const clicks = Math.floor(opens * (0.1 + Math.random() * 0.2));
            
            campaign.opens += opens;
            campaign.clicks += clicks;
            
        } catch (error) {
            console.error('Erreur envoi batch:', error);
            errors += batch.length;
            showNotification(`Erreur lors de l'envoi √† ${batch.length} contacts`, 'error');
        }
        
        updateProgress(sent, activeContacts.length);
        
        // Pause entre les batches pour respecter les limites
        await new Promise(resolve => setTimeout(resolve, 2000));
    }
    
    if (errors > 0) {
        showNotification(`Campagne envoy√©e avec ${errors} erreurs`, 'warning');
    }
    
    finalizeCampaign(campaign);
}

// Envoi d'un batch d'emails via Brevo - VERSION DEBUG
async function sendEmailBatch(contacts, campaign, apiKey) {
    console.log('=== DEBUG BREVO ===');
    console.log('API Key:', apiKey ? 'Present' : 'Missing');
    console.log('Contacts:', contacts);
    console.log('Campaign:', campaign);
    
    const emailData = {
        sender: {
            name: "EmailMax Pro",
            email: "rolandsegno@gmail.com"
        },
        to: contacts.map(contact => ({
            email: contact.email,
            name: `${contact.prenom} ${contact.nom}`.trim() || contact.email
        })),
        subject: campaign.subject,
        htmlContent: formatEmailContent(campaign.content, contacts[0]),
        textContent: campaign.content.replace(/\[PRENOM\]/g, contacts[0].prenom || '')
    };
    
    console.log('=== EMAIL DATA SENT TO BREVO ===');
    console.log(JSON.stringify(emailData, null, 2));
    
    const response = await fetch('https://api.brevo.com/v3/smtp/email', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'api-key': apiKey
        },
        body: JSON.stringify(emailData)
    });
    
    console.log('=== BREVO RESPONSE ===');
    console.log('Status:', response.status);
    console.log('StatusText:', response.statusText);
    
    const responseData = await response.json();
    console.log('Response Data:', responseData);
    
    if (!response.ok) {
        throw new Error(`Erreur Brevo: ${responseData.message || 'Erreur inconnue'}`);
    }
    
    return responseData;
}

// Formatage du contenu email
function formatEmailContent(content, contact) {
    let formattedContent = content
        .replace(/\[PRENOM\]/g, contact.prenom || 'Cher(e) contact')
        .replace(/\[NOM\]/g, contact.nom || '')
        .replace(/\[EMAIL\]/g, contact.email || '')
        .replace(/\[DATE\]/g, new Date().toLocaleDateString('fr-FR'))
        .replace(/\[UNSUBSCRIBE_LINK\]/g, '#unsubscribe')
        .replace(/\n/g, '<br>');
    
    // Template HTML simple
    return `
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; color: #333;">
            <div style="background: linear-gradient(135deg, #5D5CDE 0%, #4A4ACC 100%); padding: 20px; text-align: center; border-radius: 10px 10px 0 0;">
                <h1 style="color: white; margin: 0;">EmailMax Pro</h1>
            </div>
            <div style="background: white; padding: 30px; border-radius: 0 0 10px 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                ${formattedContent}
                <hr style="margin: 30px 0; border: none; border-top: 1px solid #eee;">
                <p style="font-size: 12px; color: #666; text-align: center;">
                    Vous recevez cet email car vous √™tes abonn√© √† notre newsletter.<br>
                    <a href="#unsubscribe" style="color: #5D5CDE;">Se d√©sabonner</a>
                </p>
            </div>
        </div>
    `;
}

// Finalisation de campagne
function finalizeCampaign(campaign) {
    campaign.status = 'sent';
    campaign.openRate = campaign.sent > 0 ? ((campaign.opens / campaign.sent) * 100).toFixed(1) : '0';
    campaign.clickRate = campaign.sent > 0 ? ((campaign.clicks / campaign.sent) * 100).toFixed(1) : '0';
    
    // Mise √† jour des analytics globales
    analytics.emailsSent += campaign.sent;
    if (analytics.emailsSent > 0) {
        analytics.openRate = ((campaigns.reduce((acc, c) => acc + c.opens, 0) / analytics.emailsSent) * 100).toFixed(1);
        analytics.clickRate = ((campaigns.reduce((acc, c) => acc + c.clicks, 0) / analytics.emailsSent) * 100).toFixed(1);
    }
    
    setTimeout(() => {
        hideProgressModal();
        showNotification(`Campagne "${campaign.name}" envoy√©e avec succ√®s √† ${campaign.sent} contacts!`, 'success');
        updateDashboard();
        updateCampaignsGrid();
    }, 1000);
}

// Gestion du modal de progression
function showProgressModal(total) {
    document.getElementById('progress-modal').classList.remove('hidden');
    document.getElementById('progress-modal').classList.add('flex');
    document.getElementById('progress-total').textContent = total;
    document.getElementById('progress-count').textContent = '0';
    document.getElementById('progress-bar').style.width = '0%';
    document.body.style.overflow = 'hidden';
}

function updateProgress(sent, total) {
    const percentage = (sent / total) * 100;
    document.getElementById('progress-count').textContent = sent;
    document.getElementById('progress-bar').style.width = percentage + '%';
    
    if (sent === total) {
        document.getElementById('progress-text').textContent = 'Envoi termin√©!';
    } else {
        document.getElementById('progress-text').textContent = `Envoi en cours... ${sent}/${total}`;
    }
}

function hideProgressModal() {
    document.getElementById('progress-modal').classList.add('hidden');
    document.getElementById('progress-modal').classList.remove('flex');
    document.body.style.overflow = '';
}

// Mise √† jour du dashboard
function updateDashboard() {
    document.getElementById('total-contacts').textContent = contacts.length;
    document.getElementById('emails-sent').textContent = analytics.emailsSent;
    document.getElementById('open-rate').textContent = analytics.openRate + '%';
    document.getElementById('click-rate').textContent = analytics.clickRate + '%';
    
    // Campagnes r√©centes
    const recentCampaignsEl = document.getElementById('recent-campaigns');
    if (campaigns.length === 0) {
        recentCampaignsEl.innerHTML = `
            <div class="text-center py-12 text-gray-500 dark:text-gray-400">
                <i data-lucide="mail" class="w-16 h-16 mx-auto mb-4 opacity-50"></i>
                <p class="text-lg font-medium mb-2">Aucune campagne encore</p>
                <p class="text-sm">Cr√©ez votre premi√®re campagne pour commencer</p>
                <button onclick="showSection('campaigns')" class="mt-4 gradient-bg text-white px-6 py-3 rounded-xl hover:opacity-90 transition-opacity">
                    Cr√©er une campagne
                </button>
            </div>
        `;
    } else {
        recentCampaignsEl.innerHTML = campaigns.slice(-3).reverse().map(campaign => `
            <div class="flex justify-between items-center p-4 bg-gray-50 dark:bg-gray-700 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                <div>
                    <h4 class="font-semibold text-gray-900 dark:text-white">${campaign.name}</h4>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Cr√©√©e le ${campaign.created}</p>
                </div>
                <div class="text-right">
                    <span class="inline-block px-3 py-1 text-xs rounded-full ${getStatusColor(campaign.status)}">${getStatusText(campaign.status)}</span>
                    ${campaign.sent > 0 ? `<p class="text-sm text-gray-600 dark:text-gray-400 mt-1">${campaign.sent} envoy√©s</p>` : ''}
                </div>
            </div>
        `).join('');
    }
    
    lucide.createIcons();
}

// Mise √† jour du tableau des contacts
function updateContactsTable() {
    document.getElementById('active-contacts').textContent = contacts.filter(c => c.status === 'active').length;
    document.getElementById('unsubscribed-contacts').textContent = contacts.filter(c => c.status === 'unsubscribed').length;
    document.getElementById('bounced-contacts').textContent = contacts.filter(c => c.status === 'bounced').length;
    
    const tbody = document.getElementById('contacts-tbody');
    if (contacts.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="5" class="text-center py-12 text-gray-500 dark:text-gray-400">
                    <i data-lucide="users" class="w-16 h-16 mx-auto mb-4 opacity-50"></i>
                    <p class="text-lg font-medium mb-2">Aucun contact import√©</p>
                    <p class="text-sm">Commencez par importer votre premi√®re liste de contacts</p>
                </td>
            </tr>
        `;
    } else {
        tbody.innerHTML = contacts.map(contact => `
            <tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                <td class="py-4 px-6 text-gray-900 dark:text-white">${contact.email}</td>
                <td class="py-4 px-6 text-gray-900 dark:text-white">${contact.nom} ${contact.prenom}</td>
                <td class="py-4 px-6">
                    <span class="inline-block px-3 py-1 text-xs rounded-full ${getContactStatusColor(contact.status)}">
                        ${getContactStatusText(contact.status)}
                    </span>
                </td>
                <td class="py-4 px-6 text-gray-600 dark:text-gray-400">${contact.dateAdded}</td>
                <td class="py-4 px-6">
                    <button onclick="editContact('${contact.email}')" class="text-primary hover:text-primary-dark mr-3 p-1">
                        <i data-lucide="edit" class="w-4 h-4"></i>
                    </button>
                    <button onclick="deleteContact('${contact.email}')" class="text-red-600 hover:text-red-800 p-1">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                </td>
            </tr>
        `).join('');
    }
    
    lucide.createIcons();
}

// Mise √† jour de la grille des campagnes
function updateCampaignsGrid() {
    const grid = document.getElementById('campaigns-grid');
    if (campaigns.length === 0) {
        grid.innerHTML = `
            <div class="col-span-full">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-12 text-center">
                    <i data-lucide="send" class="w-20 h-20 mx-auto mb-6 text-gray-400 dark:text-gray-500"></i>
                    <h3 class="text-2xl font-semibold text-gray-900 dark:text-white mb-3">Aucune campagne</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-6 text-lg">Cr√©ez votre premi√®re campagne email pour commencer</p>
                    <button onclick="showCampaignModal()" class="gradient-bg text-white px-8 py-4 rounded-xl hover:opacity-90 transition-opacity text-lg font-medium">
                        Cr√©er une campagne
                    </button>
                </div>
            </div>
        `;
    } else {
        grid.innerHTML = campaigns.map(campaign => `
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden card-hover">
                <div class="p-6">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white">${campaign.name}</h3>
                        <span class="inline-block px-3 py-1 text-xs rounded-full ${getStatusColor(campaign.status)}">${getStatusText(campaign.status)}</span>
                    </div>
                    <p class="text-gray-600 dark:text-gray-400 mb-6 line-clamp-2">${campaign.subject}</p>
                    <div class="space-y-3 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600 dark:text-gray-400">Cr√©√©e le:</span>
                            <span class="text-gray-900 dark:text-white font-medium">${campaign.created}</span>
                        </div>
                        ${campaign.sent > 0 ? `
                            <div class="flex justify-between">
                                <span class="text-gray-600 dark:text-gray-400">Envoy√©s:</span>
                                <span class="text-gray-900 dark:text-white font-medium">${campaign.sent}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600 dark:text-gray-400">Ouvertures:</span>
                                <span class="text-gray-900 dark:text-white font-medium">${campaign.openRate}%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600 dark:text-gray-400">Clics:</span>
                                <span class="text-gray-900 dark:text-white font-medium">${campaign.clickRate}%</span>
                            </div>
                        ` : ''}
                    </div>
                    <div class="mt-6 flex gap-2">
                        ${campaign.status === 'draft' ? `
                            <button onclick="sendCampaign(${JSON.stringify(campaign).replace(/"/g, '&quot;')})" class="flex-1 gradient-bg text-white py-2 rounded-xl hover:opacity-90 transition-opacity text-sm font-medium">
                                Envoyer
                            </button>
                        ` : ''}
                        <button onclick="viewCampaign(${campaign.id})" class="flex-1 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-sm font-medium">
                            D√©tails
                        </button>
                    </div>
                </div>
            </div>
        `).join('');
    }
    
    lucide.createIcons();
}

// Utilisation de templates
function useTemplate(templateType) {
    showCampaignModal();
    
    const templates = {
        newsletter: {
            subject: "Newsletter - D√©couvrez nos derni√®res actualit√©s",
            content: `Bonjour [PRENOM],

Nous esp√©rons que vous allez bien ! Voici les derni√®res actualit√©s :

üî• NOUVEAUT√âS
‚Ä¢ Nouveau produit lanc√© avec succ√®s
‚Ä¢ Mise √† jour de nos services
‚Ä¢ √âv√©nement √† venir

üìà CHIFFRES CL√âS
‚Ä¢ 1000+ clients satisfaits
‚Ä¢ 95% de satisfaction
‚Ä¢ Croissance de 50%

üí° CONSEIL DU MOIS
N'h√©sitez pas √† nous contacter pour toute question.

Cordialement,
L'√©quipe EmailMax Pro`
        },
        promotion: {
            subject: "üéâ Offre Sp√©ciale - R√©duction de 50% limit√©e",
            content: `Bonjour [PRENOM],

üéâ OFFRE EXCEPTIONNELLE ! üéâ

Profitez de notre promotion exclusive :
‚Ä¢ 50% de r√©duction sur tous nos produits
‚Ä¢ Livraison gratuite
‚Ä¢ Garantie satisfait ou rembours√©

‚è∞ Offre valable jusqu'au [DATE]

Cette offre est limit√©e dans le temps, ne la manquez pas !

L'√©quipe EmailMax Pro`
        },
        event: {
            subject: "üéØ Invitation - Webinaire gratuit sur le marketing digital",
            content: `Bonjour [PRENOM],

üéØ WEBINAIRE GRATUIT üéØ

Vous √™tes invit√©(e) √† notre webinaire exclusif :
"Les secrets du marketing digital en 2024"

üìÖ Date : [DATE]
‚è∞ Heure : 14h00 - 15h30
üé• Plateforme : Zoom

Au programme :
‚Ä¢ Strat√©gies marketing actuelles
‚Ä¢ Outils indispensables
‚Ä¢ Session Q&A en direct

Places limit√©es !

√Ä bient√¥t,
L'√©quipe EmailMax Pro`
        }
    };
    
    const template = templates[templateType];
    if (template) {
        setTimeout(() => {
            document.getElementById('campaign-subject').value = template.subject;
            document.getElementById('campaign-content').value = template.content;
        }, 100);
    }
}

// Recherche et filtrage des contacts
document.getElementById('search-contacts')?.addEventListener('input', filterContacts);
document.getElementById('filter-status')?.addEventListener('change', filterContacts);

function filterContacts() {
    const searchTerm = document.getElementById('search-contacts')?.value.toLowerCase() || '';
    const statusFilter = document.getElementById('filter-status')?.value || '';
    
    let filteredContacts = contacts;
    
    if (searchTerm) {
        filteredContacts = filteredContacts.filter(contact => 
            contact.email.toLowerCase().includes(searchTerm) ||
            (contact.nom + ' ' + contact.prenom).toLowerCase().includes(searchTerm)
        );
    }
    
    if (statusFilter) {
        filteredContacts = filteredContacts.filter(contact => contact.status === statusFilter);
    }
    
    // Mise √† jour du tableau avec les r√©sultats filtr√©s
    const tbody = document.getElementById('contacts-tbody');
    if (filteredContacts.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="5" class="text-center py-12 text-gray-500 dark:text-gray-400">
                    <i data-lucide="search" class="w-16 h-16 mx-auto mb-4 opacity-50"></i>
                    <p class="text-lg font-medium mb-2">Aucun contact trouv√©</p>
                    <p class="text-sm">Aucun r√©sultat ne correspond √† vos crit√®res de recherche</p>
                </td>
            </tr>
        `;
    } else {
        tbody.innerHTML = filteredContacts.map(contact => `
            <tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                <td class="py-4 px-6 text-gray-900 dark:text-white">${contact.email}</td>
                <td class="py-4 px-6 text-gray-900 dark:text-white">${contact.nom} ${contact.prenom}</td>
                <td class="py-4 px-6">
                    <span class="inline-block px-3 py-1 text-xs rounded-full ${getContactStatusColor(contact.status)}">
                        ${getContactStatusText(contact.status)}
                    </span>
                </td>
                <td class="py-4 px-6 text-gray-600 dark:text-gray-400">${contact.dateAdded}</td>
                <td class="py-4 px-6">
                    <button onclick="editContact('${contact.email}')" class="text-primary hover:text-primary-dark mr-3 p-1">
                        <i data-lucide="edit" class="w-4 h-4"></i>
                    </button>
                    <button onclick="deleteContact('${contact.email}')" class="text-red-600 hover:text-red-800 p-1">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                </td>
            </tr>
        `).join('');
    }
    
    lucide.createIcons();
}

// Fonctions utilitaires
function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

function getStatusColor(status) {
    switch(status) {
        case 'draft': return 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300';
        case 'scheduled': return 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300';
        case 'sending': return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300';
        case 'sent': return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300';
        default: return 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300';
    }
}

function getStatusText(status) {
    switch(status) {
        case 'draft': return 'Brouillon';
        case 'scheduled': return 'Programm√©e';
        case 'sending': return 'En cours';
        case 'sent': return 'Envoy√©e';
        default: return status;
    }
}

function getContactStatusColor(status) {
    switch(status) {
        case 'active': return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300';
        case 'unsubscribed': return 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300';
        case 'bounced': return 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300';
        default: return 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300';
    }
}

function getContactStatusText(status) {
    switch(status) {
        case 'active': return 'Actif';
        case 'unsubscribed': return 'D√©sabonn√©';
        case 'bounced': return 'Bounce';
        default: return status;
    }
}

function updateAnalytics() {
    analytics.totalContacts = contacts.length;
    analytics.activeContacts = contacts.filter(c => c.status === 'active').length;
    analytics.unsubscribedContacts = contacts.filter(c => c.status === 'unsubscribed').length;
    analytics.bouncedContacts = contacts.filter(c => c.status === 'bounced').length;
}

function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 p-4 rounded-xl shadow-lg z-50 transition-all duration-300 ${
        type === 'success' ? 'bg-green-500 text-white' :
        type === 'error' ? 'bg-red-500 text-white' :
        type === 'warning' ? 'bg-orange-500 text-white' :
        'bg-blue-500 text-white'
    }`;
    notification.innerHTML = `
        <div class="flex items-center space-x-3">
            <i data-lucide="${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : type === 'warning' ? 'alert-triangle' : 'info'}" class="w-5 h-5"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    lucide.createIcons();
    
    // Animation d'entr√©e
    setTimeout(() => {
        notification.style.transform = 'translateX(0)';
        notification.style.opacity = '1';
    }, 100);
    
    // Suppression automatique
    setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        notification.style.opacity = '0';
        setTimeout(() => notification.remove(), 300);
    }, 5000);
}

// Fonctions d'action (placeholders)
function editContact(email) {
    showNotification('Fonction d\'√©dition en d√©veloppement', 'info');
}

function deleteContact(email) {
    if (showConfirmDialog('√ätes-vous s√ªr de vouloir supprimer ce contact ?', () => {
        const index = contacts.findIndex(c => c.email === email);
        if (index > -1) {
            contacts.splice(index, 1);
            updateContactsTable();
            updateAnalytics();
            updateDashboard();
            showNotification('Contact supprim√© avec succ√®s', 'success');
        }
    })) {
        // La confirmation est g√©r√©e par la callback
    }
}

function viewCampaign(id) {
    showNotification('Vue d√©taill√©e en d√©veloppement', 'info');
}

// Dialogue de confirmation personnalis√©
function showConfirmDialog(message, onConfirm) {
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
    modal.innerHTML = `
        <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-2xl max-w-md w-full mx-4">
            <div class="text-center">
                <i data-lucide="alert-triangle" class="w-12 h-12 mx-auto mb-4 text-orange-500"></i>
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Confirmation</h3>
                <p class="text-gray-600 dark:text-gray-400 mb-6">${message}</p>
                <div class="flex space-x-3">
                    <button onclick="this.closest('.fixed').remove()" class="flex-1 px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors">
                        Annuler
                    </button>
                    <button onclick="this.closest('.fixed').remove(); (${onConfirm.toString()})()" class="flex-1 px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded-xl transition-colors">
                        Confirmer
                    </button>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    lucide.createIcons();
    return true;
}

// Initialisation de l'application
document.addEventListener('DOMContentLoaded', function() {
    lucide.createIcons();
    updateDashboard();
    
    // Navigation par d√©faut
    document.querySelector('.nav-item').classList.add('bg-primary', 'text-white');
    document.querySelector('.nav-item').classList.remove('text-gray-700', 'dark:text-gray-300');
    
    // Application pr√™te - pas de donn√©es de d√©monstration
});
</script>

</body>
</html>
